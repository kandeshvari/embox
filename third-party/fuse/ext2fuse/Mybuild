package third_party.ext2fuse


@Build(stage=1,script="$(EXTERNAL_MAKE)")
@BuildArtifactPath(cppflags="-I$(abspath $(EXTERNAL_BUILD_DIR))/third_party/ext2fuse/core/install/src")
@BuildDepends(third_party.fuse.core)
@BuildDepends(third_party.e2fsprogs.core)
static module core {
	@AddPrefix("^BUILD/extbld/^MOD_PATH/../core/install/src")
	source "*.o"

	depends embox.compat.posix.fs.statvfs
	@NoRuntime depends third_party.e2fsprogs.core
	@NoRuntime depends third_party.fuse.core
}

module ext2fuse_driver {
	@IncludePath("$(EXTERNAL_BUILD_DIR)/third_party/fuse/core/install/include")
	@IncludePath("$(ROOT_DIR)/third-party/fuse/ext2fuse/include")
	@IncludePath("$(ROOT_DIR)/third-party/fuse/fuse")
	source "ext2fuse.c"

	@NoRuntime depends core
	depends embox.fs.core
	depends ext2fuse_xattr
}

module ext2fuse_xattr {
	@IncludePath("$(EXTERNAL_BUILD_DIR)/third_party/fuse/core/install/include")
	@IncludePath("$(EXTERNAL_BUILD_DIR)/third_party/e2fsprogs/core/install/include")
	@IncludePath("$(EXTERNAL_BUILD_DIR)/third_party/ext2fuse/core/install/src")
	@IncludePath("$(ROOT_DIR)/third-party/fuse/ext2fuse/include")
	@IncludePath("$(ROOT_DIR)/third-party/fuse/fuse")
	source "ext2fuse_xattr.c"

	@NoRuntime depends core
	depends embox.fs.core
}
